# Production environment configuration
# Phase 1 (MVP): ETL Pipeline Only
environment: production

aws:
  account_id: ${AWS_ACCOUNT_ID}
  region: ${AWS_REGION}
  profile: default

  services:
    lambda:
      memory_size: 1024  # More memory for better performance
      timeout: 300
      reserved_concurrency: 50

    rds:
      instance_class: db.t3.small  # Production instance
      allocated_storage: 50
      max_allocated_storage: 100  # Auto-scaling storage
      backup_retention_period: 7  # Keep backups for 7 days
      backup_window: "03:00-04:00"
      maintenance_window: "sun:04:00-sun:05:00"
      multi_az: false  # Enable when needed
      deletion_protection: true
      performance_insights_enabled: false

database:
  host: ${DB_HOST}
  port: ${DB_PORT}
  name: ${DB_NAME}
  username: ${DB_USERNAME}
  password: ${DB_PASSWORD}
  pool_size: 20
  pool_recycle: 3600
  echo_sql: false  # No SQL logging in prod
  ssl_mode: prefer

s3:
  data_bucket: ${DATA_BUCKET}  # Single bucket for all data (raw/processed)
  versioning_enabled: true
  encryption: AES256
  lifecycle_rules:
    raw_data_expiration_days: 365
    processed_data_expiration_days: 730
    glacier_transition_days: 180

stepfunctions:
  state_machine_arn: ${ETL_PIPELINE_ARN}
  execution_timeout: 7200

eventbridge:
  schedule: "cron(0 6 * * ? *)"  # 6 AM UTC daily
  dlq_enabled: false  # Enable when SNS is set up

data_pipeline:
  batch_size: 500
  max_retries: 3
  retry_delay: 5

logging:
  level: INFO  # Less verbose for production
  format: json
  cloudwatch:
    log_group: /aws/lambda/nba-cap-production
    retention_days: 30  # Keep logs for 30 days

monitoring:
  xray_enabled: true
  xray_sampling_rate: 0.1  # Trace 10% of requests to reduce costs
  metrics_namespace: NBACapOptimizer/Prod
  alarms_enabled: true
  cloudwatch_dashboard: nba-cap-optimizer-prod

  alarms:
    lambda_duration_threshold: 250000  # milliseconds
    lambda_error_threshold: 5  # errors per 5 minutes
    db_cpu_threshold: 80  # Percent
    db_connections_threshold: 80  # Percent of max
    etl_failure_threshold: 1  # Step Function failures

security:
  secrets_manager_enabled: true
  secret_arn: ${SECRET_ARN}
  # VPC settings (available from Terraform outputs after deploy)
  vpc_enabled: true
  vpc_id: ${VPC_ID}  # Set from Terraform output
  private_subnet_ids: ${PRIVATE_SUBNET_IDS}  # Set from Terraform output
  security_group_ids: ${SECURITY_GROUP_IDS}  # Set from Terraform output

cost_tags:
  Environment: production
  Project: nba-cap-optimizer
  ManagedBy: terraform
  CostCenter: prod
  Backup: "true"

# Notes:
# - VPC configuration will be available after first Terraform apply
# - Phase 2 will add: SageMaker configuration
# - Phase 3 will add: API Gateway configuration
# - Phase 4 will add: Frontend configuration
# - SNS topics for alarms can be added when needed
